<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>Mini Clash Top-Down</title>
<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #a1c4fd, #c2e9fb);
    user-select: none;
  }
  #game {
    max-width: 720px;
    margin: 15px auto;
    background: #e3f2fd;
    border-radius: 12px;
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    padding: 15px;
  }
  #resources {
    display: flex;
    justify-content: space-around;
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 10px;
  }
  #build-buttons {
    text-align: center;
    margin-bottom: 10px;
  }
  #build-buttons button {
    background: #4caf50;
    border: none;
    padding: 10px 15px;
    margin: 0 6px;
    border-radius: 8px;
    font-weight: 600;
    color: white;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  #build-buttons button:hover {
    background: #388e3c;
  }
  #map {
    position: relative;
    display: grid;
    grid-template-columns: repeat(12, 56px);
    grid-template-rows: repeat(8, 56px);
    gap: 6px;
    justify-content: center;
    background: #81c784;
    border-radius: 15px;
    padding: 8px;
  }
  .cell {
    position: relative;
    background: linear-gradient(145deg, #a5d6a7, #66bb6a);
    border-radius: 12px;
    box-shadow: inset 3px 3px 7px #5a9d4a,
                inset -3px -3px 5px #a4df8a;
    cursor: pointer;
    transition: transform 0.15s ease;
  }
  .cell:hover {
    transform: scale(1.05);
    box-shadow: 0 0 12px #66bb6a;
  }
  .building {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border-radius: 50%;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    animation: pulse 2s infinite alternate;
  }
  .building.house {
    background: linear-gradient(145deg, #ffd54f, #ffb300);
    border: 2px solid #ffca28;
  }
  .building.barracks {
    background: linear-gradient(145deg, #64b5f6, #1976d2);
    border: 2px solid #42a5f5;
  }
  @keyframes pulse {
    0% { box-shadow: 0 0 8px rgba(0,0,0,0.1); }
    100% { box-shadow: 0 0 15px rgba(0,0,0,0.3); }
  }
  /* Юниты */
  .unit {
    position: absolute;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: linear-gradient(145deg, #f44336, #d32f2f);
    box-shadow: 0 3px 5px rgba(0,0,0,0.4);
    animation: unit-walk 1s steps(4) infinite;
    pointer-events: none;
  }
  @keyframes unit-walk {
    0%, 100% { filter: brightness(1); }
    50% { filter: brightness(0.85); }
  }
  #info {
    margin-top: 12px;
    text-align: center;
    font-weight: 600;
    min-height: 24px;
  }
</style>
</head>
<body>

<div id="game">
  <div id="resources">
    <div>Золото: <span id="gold">100</span></div>
    <div>Нефть: <span id="oil">50</span></div>
  </div>
  <div id="build-buttons">
    <button data-building="house">Дом (20 золота)</button>
    <button data-building="barracks">Казармы (50 золота)</button>
    <button id="create-unit-btn" disabled>Создать юнита (10 золота)</button>
  </div>
  <div id="map"></div>
  <div id="info">Выберите здание для строительства</div>
</div>

<script>
  const mapWidth = 12;
  const mapHeight = 8;
  const map = document.getElementById('map');
  const goldSpan = document.getElementById('gold');
  const oilSpan = document.getElementById('oil');
  const info = document.getElementById('info');
  const createUnitBtn = document.getElementById('create-unit-btn');

  let gold = 100;
  let oil = 50;
  let selectedBuilding = null;
  let barracksCells = [];

  // Стоимость зданий
  const costs = {
    house: { gold: 20, oil: 0 },
    barracks: { gold: 50, oil: 0 },
    unit: { gold: 10 }
  };

  // Карта - массив клеток с объектами
  const cells = [];

  // Создаем сетку карты
  for(let y=0; y < mapHeight; y++){
    for(let x=0; x < mapWidth; x++){
      const cell = document.createElement('div');
      cell.classList.add('cell');
      cell.dataset.x = x;
      cell.dataset.y = y;
      map.appendChild(cell);
      cells.push(cell);
    }
  }

  // Обработчик кнопок строительства
  document.getElementById('build-buttons').addEventListener('click', e => {
    if(e.target.tagName !== 'BUTTON') return;
    if(e.target.id === 'create-unit-btn') {
      createUnit();
      return;
    }
    const bld = e.target.dataset.building;
    if(costs[bld]){
      selectedBuilding = bld;
      info.textContent = `Вы выбрали: ${bld}. Кликните по клетке для постройки.`;
    }
  });

  // Строим здание по клику
  map.addEventListener('click', e => {
    if(!selectedBuilding) {
      info.textContent = "Сначала выберите здание для постройки.";
      return;
    }
    if(!e.target.classList.contains('cell')) return;
    const cell = e.target;
    if(cell.querySelector('.building')){
      info.textContent = "На этой клетке уже есть здание!";
      return;
    }
    // Проверяем ресурсы
    if(gold < costs[selectedBuilding].gold){
      info.textContent = "Недостаточно золота!";
      return;
    }
    // Строим здание
    gold -= costs[selectedBuilding].gold;
    goldSpan.textContent = gold;

    const buildingDiv = document.createElement('div');
    buildingDiv.classList.add('building', selectedBuilding);
    cell.appendChild(buildingDiv);

    info.textContent = `${selectedBuilding} построен!`;

    // Если построили казармы, включаем кнопку создания юнитов
    if(selectedBuilding === 'barracks'){
      barracksCells.push(cell);
      createUnitBtn.disabled = false;
    }

    selectedBuilding = null;
  });

  // Создание юнита из случайной казармы
  function createUnit(){
    if(gold < costs.unit.gold){
      info.textContent = "Недостаточно золота на юнита!";
      return;
    }
    if(barracksCells.length === 0){
      info.textContent = "Постройте хотя бы одну казарму!";
      return;
    }
    gold -= costs.unit.gold;
    goldSpan.textContent = gold;

    // Создаем юнита в случайной казарме
    const barracksCell = barracksCells[Math.floor(Math.random() * barracksCells.length)];
    const unit = document.createElement('div');
    unit.classList.add('unit');
    map.appendChild(unit);

    // Начальные координаты (центр клетки казармы)
    const rect = barracksCell.getBoundingClientRect();
    const mapRect = map.getBoundingClientRect();
    const startX = rect.left - mapRect.left + rect.width/2 - unit.offsetWidth/2;
    const startY = rect.top - mapRect.top + rect.height/2 - unit.offsetHeight/2;

    unit.style.left = startX + 'px';
    unit.style.top = startY + 'px';

    info.textContent = "Юнит создан! Он двигается по карте.";

    moveUnitRandom(unit);
  }

  // Двигаем юнита случайным образом по карте
  function moveUnitRandom(unit){
    const cellSize = cells[0].offsetWidth + 6; // с учетом gap

    let posX = parseFloat(unit.style.left);
    let posY = parseFloat(unit.style.top);

    // Выбираем новую цель в пределах карты (в пикселях)
    const targetCellX = Math.floor(Math.random() * mapWidth);
    const targetCellY = Math.floor(Math.random() * mapHeight);

    const mapRect = map.getBoundingClientRect();

    const targetX = targetCellX * (cellSize) + cellSize/2 - unit.offsetWidth/2;
    const targetY = targetCellY * (cellSize) + cellSize/2 - unit.offsetHeight/2;

    const duration = 2000 + Math.random() * 3000; // 2-5 секунд движение

    const startTime = performance.now();

    function animate(time){
      const elapsed = time - startTime;
      const progress = Math.min(elapsed / duration, 1);

      unit.style.left = posX + (targetX - posX)*progress + 'px';
      unit.style.top = posY + (targetY - posY)*progress + 'px';

      if(progress < 1){
        requestAnimationFrame(animate);
      } else {
        // Как только достигли цели, двигаемся снова
        moveUnitRandom(unit);
      }
    }
    requestAnimationFrame(animate);
  }

  // Автоматический сбор ресурсов каждые 5 секунд
  setInterval(() => {
    // За каждый дом добавляем золото
    const houses = cells.filter(c => c.querySelector('.building.house')).length;
    if(houses > 0){
      gold += houses * 5;
      goldSpan.textContent = gold;
      info.textContent = `Собрали ${houses * 5} золота с домов!`;
    }
  }, 5000);

</script>

</body>
</html>
