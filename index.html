<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ClashLite - Мини игра</title>
<style>
  body {
    margin: 0;
    background: #222;
    font-family: Arial, sans-serif;
    color: #eee;
    user-select: none;
  }
  #game-container {
    position: relative;
    width: 800px;
    height: 600px;
    margin: 20px auto;
    background: #2c3e50;
    border: 3px solid #34495e;
    overflow: hidden;
  }
  #map {
    position: relative;
    width: 800px;
    height: 600px;
    background: linear-gradient(45deg, #34495e 25%, #2c3e50 25%, #2c3e50 50%, #34495e 50%, #34495e 75%, #2c3e50 75%, #2c3e50);
    background-size: 40px 40px;
  }
  .building {
    position: absolute;
    width: 60px;
    height: 60px;
    border-radius: 8px;
    box-sizing: border-box;
    border: 2px solid #ccc;
    text-align: center;
    line-height: 60px;
    font-weight: bold;
    cursor: default;
    transition: box-shadow 0.3s ease;
  }
  .building.house {
    background: #f39c12;
    border-color: #e67e22;
  }
  .building.oil {
    background: #16a085;
    border-color: #1abc9c;
  }
  .building.barracks {
    background: #2980b9;
    border-color: #3498db;
  }
  .unit {
    position: absolute;
    width: 30px;
    height: 30px;
    background: #e74c3c;
    border-radius: 50%;
    border: 2px solid #c0392b;
    box-sizing: border-box;
    transition: transform 0.3s linear;
  }
  #ui {
    width: 800px;
    margin: 10px auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #eee;
    font-size: 18px;
  }
  #resources {
    user-select: none;
  }
  button {
    background: #34495e;
    color: #eee;
    border: none;
    padding: 8px 15px;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #3c5d7c;
  }
  #info {
    width: 800px;
    margin: 5px auto;
    height: 24px;
    color: #f1c40f;
    font-weight: bold;
    text-align: center;
    user-select: none;
    min-height: 24px;
  }
</style>
</head>
<body>

<div id="game-container">
  <div id="map"></div>
</div>

<div id="ui">
  <div id="resources">
    Золото: <span id="gold">0</span> | Нефть: <span id="oil">0</span>
  </div>
  <div>
    <button id="create-unit-btn">Создать юнита (100 золота)</button>
    <button id="pause-btn">Пауза</button>
  </div>
</div>

<div id="info"></div>

<script>
  // Игровые данные
  const map = document.getElementById('map');
  const goldEl = document.getElementById('gold');
  const oilEl = document.getElementById('oil');
  const infoEl = document.getElementById('info');
  const createUnitBtn = document.getElementById('create-unit-btn');
  const pauseBtn = document.getElementById('pause-btn');

  let gamePaused = false;

  let resources = {
    gold: 500,
    oil: 300
  };

  // Постройки с координатами (x, y)
  const buildings = [
    { id: 'house1', type: 'house', x: 100, y: 100, gatherRate: 5, gatherTimer: 0 },
    { id: 'house2', type: 'house', x: 650, y: 150, gatherRate: 5, gatherTimer: 0 },
    { id: 'oil1', type: 'oil', x: 120, y: 450, gatherRate: 3, gatherTimer: 0 },
    { id: 'oil2', type: 'oil', x: 600, y: 400, gatherRate: 3, gatherTimer: 0 },
    { id: 'barracks', type: 'barracks', x: 350, y: 250 }
  ];

  // Юниты
  let units = [];

  // Создаём и отображаем постройки
  function drawBuildings() {
    map.innerHTML = '';
    buildings.forEach(b => {
      const el = document.createElement('div');
      el.classList.add('building', b.type);
      el.style.left = b.x + 'px';
      el.style.top = b.y + 'px';
      el.textContent = b.type === 'barracks' ? 'Казарма' : b.type === 'house' ? 'Дом' : 'Вышка';
      el.dataset.id = b.id;
      map.appendChild(el);
      b.element = el;
    });
  }

  // Создаём юнита возле казармы
  function createUnit() {
    if (resources.gold < 100) {
      showInfo('Недостаточно золота для создания юнита!');
      return;
    }
    const barracks = buildings.find(b => b.type === 'barracks');
    if (!barracks) return;

    resources.gold -= 100;
    updateResources();

    const unit = {
      id: 'unit' + Date.now(),
      x: barracks.x + 70,
      y: barracks.y + 15,
      target: null,
      element: null,
      state: 'patrol',
      patrolDirection: 1,
      patrolRange: 80,
      patrolCenterX: barracks.x + 70,
      speed: 1.2,
      size: 30,
      hp: 100,
    };

    const el = document.createElement('div');
    el.classList.add('unit');
    el.style.left = unit.x + 'px';
    el.style.top = unit.y + 'px';
    map.appendChild(el);
    unit.element = el;

    units.push(unit);
    showInfo('Создан юнит!');
  }

  // Обновление ресурсов в интерфейсе
  function updateResources() {
    goldEl.textContent = Math.floor(resources.gold);
    oilEl.textContent = Math.floor(resources.oil);
  }

  // Вывод сообщений
  let infoTimeout;
  function showInfo(text) {
    clearTimeout(infoTimeout);
    infoEl.textContent = text;
    infoTimeout = setTimeout(() => {
      infoEl.textContent = '';
    }, 3000);
  }

  // Логика автоматического сбора ресурсов с построек
  function gatherResources(delta) {
    buildings.forEach(b => {
      if (b.type === 'house' || b.type === 'oil') {
        b.gatherTimer += delta;
        if (b.gatherTimer >= 2000) { // каждые 2 секунды
          if (b.type === 'house') {
            resources.gold += b.gatherRate;
          } else {
            resources.oil += b.gatherRate;
          }
          b.gatherTimer = 0;
          updateResources();
        }
      }
    });
  }

  // Патруль юнита — ходит туда-сюда по оси X в пределах patrolRange
  function patrol(unit) {
    unit.x += unit.speed * unit.patrolDirection;
    if (unit.x > unit.patrolCenterX + unit.patrolRange) unit.patrolDirection = -1;
    else if (unit.x < unit.patrolCenterX - unit.patrolRange) unit.patrolDirection = 1;
  }

  // Обновление позиции и отрисовка юнитов
  function updateUnits() {
    units.forEach(unit => {
      if (unit.state === 'patrol') {
        patrol(unit);
      }
      unit.element.style.transform = `translate(${unit.x}px, ${unit.y}px)`;
    });
  }

  // Главный цикл игры
  let lastTime = 0;
  function gameLoop(timestamp) {
    if (!lastTime) lastTime = timestamp;
    const delta = timestamp - lastTime;
    lastTime = timestamp;

    if (!gamePaused) {
      gatherResources(delta);
      updateUnits();
    }

    requestAnimationFrame(gameLoop);
  }

  // Обработчики кнопок
  createUnitBtn.addEventListener('click', () => {
    if (!gamePaused) createUnit();
  });

  pauseBtn.addEventListener('click', () => {
    gamePaused = !gamePaused;
    pauseBtn.textContent = gamePaused ? 'Продолжить' : 'Пауза';
    showInfo(gamePaused ? 'Игра на паузе' : 'Игра возобновлена');
  });

  // Инициализация
  drawBuildings();
  updateResources();
  requestAnimationFrame(gameLoop);

</script>
</body>
</html>
